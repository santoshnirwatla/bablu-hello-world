pipeline {
    agent any
    environment {
        GCP_VM_CREDENTIALS = credentials('gcp-ssh-credentials-id') // Replace with your SSH credentials ID
    }
    stages {
        stage('Clone Repository') {
            steps {
                // Cloning the repository with the "Hello World" app
                git 'https://github.com/your-repo/hello-world.git'
            }
        }
        stage('Deploy to GCP VM') {
            steps {
                // Deploy the app to the GCP VM using SSH
                sshagent (credentials: ['gcp-ssh-credentials-id']) {
                    sh """
                    ssh -o StrictHostKeyChecking=no user@GCP_VM_IP 'mkdir -p ~/deploy/hello-world'
                    scp -o StrictHostKeyChecking=no hello.py user@GCP_VM_IP:~/deploy/hello-world
                    ssh -o StrictHostKeyChecking=no user@GCP_VM_IP 'python3 ~/deploy/hello-world/hello.py'
                    """
                }
            }
        }
    }
    post {
        success {
            echo 'Deployment successful!'
        }
        failure {
            echo 'Deployment failed!'
        }
    }
}
